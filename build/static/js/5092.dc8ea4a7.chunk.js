"use strict";(self.webpackChunkreact_admin=self.webpackChunkreact_admin||[]).push([[5092],{85092:(e,o,t)=>{t.r(o),t.d(o,{default:()=>le,formatNumber:()=>re});var r=t(89379),n=t(80045),i=t(65043),l=t(26240),a=t(72882),d=t(46946),s=t(94496),u=t(8591),c=t(59314),v=t(60587),p=t(65204),m=t(19955),h=t(40360),f=t(88911),g=t(97334),x=t(57556),y=t(78632),C=t(17434),A=t(74050),b=t(94814),j=t(42788),N=t(56894),I=t(71716),w=t(63777),k=t(81105),O=t(84391),R=t(88042),S=t(16485),P=t(61976),L=t(73216),E=t(4721),q=t(73192),D=t(15505),M=t(41119),T=t(66498),B=t(34044),F=t(77265),z=t(83074),U=t(57488),W=(t(92342),t(9551)),G=t(16017),_=t(85337),K=t(49589),V=t(47805),H=t(48292),Y=t(54007),Z=t(73990),$=t(70579);const J=["id"],Q=["patientFirstName","patientMiddleName","patientLastName"],X=["patientFirstName","patientMiddleName","patientLastName","rquestedServices"],ee=["services","price","amount"],oe=(0,z.N8)(),te=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}),re=e=>{const o=te.format(Math.abs(e));return e<0?"(".concat(o,")"):o},ne={Cash:(0,$.jsx)(D.A,{}),CBHI:(0,$.jsx)(T.A,{}),Credit:(0,$.jsx)(M.A,{}),"Free of Charge":(0,$.jsx)(q.A,{}),Reversed:(0,$.jsx)(Z.A,{}),Digital:(0,$.jsx)(E.A,{}),Traffic:(0,$.jsx)(K.A,{})},ie={PRNo:"",services:"",method:"",digitalChannel:"",trxref:"",organization:"",employeeId:""};const le=function(){var e,o,t,E,q;const[D,M]=(0,i.useState)([]),[T,z]=(0,i.useState)(!1),[K,Z]=(0,i.useState)(!1),[te,le]=(0,i.useState)(null),[ae,de]=(0,i.useState)([]),[se,ue]=(0,i.useState)([]),[ce,ve]=(0,i.useState)(ie),[pe,me]=(0,i.useState)(""),[he,fe]=(0,i.useState)(""),[ge,xe]=(0,i.useState)(ie),[ye,Ce]=(0,i.useState)([]),[Ae,be]=(0,i.useState)([]),[je,Ne]=(0,i.useState)({}),[Ie,we]=(0,i.useState)(0),[ke,Oe]=(0,i.useState)(!1),[Re,Se]=(0,i.useState)(!1),[Pe,Le]=(0,i.useState)(!1),[Ee,qe]=(0,i.useState)(!1),[De,Me]=(0,i.useState)(null),[Te,Be]=(0,i.useState)(!1),[Fe,ze]=(0,i.useState)(!1),[Ue,We]=(0,i.useState)(!1),[Ge,_e]=(0,i.useState)(!1),[Ke,Ve]=(0,i.useState)("ALL"),[He,Ye]=(0,i.useState)([]),[Ze,$e]=(0,i.useState)([]),Je=(0,L.Zp)(),Qe=(0,l.A)(),Xe=(0,w.LU)(Qe.palette.mode),eo=e=>{try{var o;const t=null===He||void 0===He?void 0:He.find((o=>(null===o||void 0===o?void 0:o.name)===e));return null!==(o=null===t||void 0===t?void 0:t.count)&&void 0!==o?o:0}catch(t){return console.error("This is getCountByLocation Error :  ",t),0}};(0,i.useEffect)((()=>{(()=>{try{if((null===D||void 0===D?void 0:D.length)>0){const e=D.flatMap((e=>{var o;return null===e||void 0===e||null===(o=e.requestedCatagories)||void 0===o?void 0:o.map((e=>null===e||void 0===e?void 0:e.purpose))})),o=new Set(e),t=["ALL",...Array.from(o).sort(((e,o)=>e.localeCompare(o)))];$e(t);const r=e.reduce(((e,o)=>(o&&(e[o]=(e[o]||0)+1),e)),{});r.ALL=e.length;const n=Object.entries(r).map((e=>{let[o,t]=e;return{name:o,count:t}}));Ye(n)}}catch(e){console.error("This is getLocations Error: ",e)}})()}),[D]),(0,i.useEffect)((()=>{const e=null===ae||void 0===ae?void 0:ae.filter((e=>(0,Y.f)(e.type)===(0,Y.f)(null===ce||void 0===ce?void 0:ce.method))).some((e=>Array.isArray(e.description)&&e.description.some((e=>(null===e||void 0===e?void 0:e.description)&&e.description.toString().trim().length>0))));if(e){var o;const e=null===ae||void 0===ae||null===(o=ae.filter((e=>(0,Y.f)(e.type)===(0,Y.f)(null===ce||void 0===ce?void 0:ce.method)))[0])||void 0===o?void 0:o.description;be(e)}else be([]);_e(e)}),[ae,null===ce||void 0===ce?void 0:ce.method]),(0,i.useEffect)((()=>{(async()=>{try{const t=await F.A.get("/Lookup/payment-type-description");var e,o;200===(null===t||void 0===t?void 0:t.status)&&de(null===(e=t.data.data)||void 0===e||null===(o=e.map(((e,o)=>{let{id:t}=e,i=(0,n.A)(e,J);return(0,r.A)({id:o+1,mainId:t},i)})))||void 0===o?void 0:o.filter((e=>(0,Y.f)(null===e||void 0===e?void 0:e.type)!==(0,Y.f)("all"))))}catch(t){console.error("Fetch error:",t),U.oR.error("Failed to load payment types")}})()}),[]);const oo=(null===D||void 0===D||null===(e=D.filter((e=>{if("ALL"===Ke)return!0;const o=null===e||void 0===e?void 0:e.requestedCatagories;return!(!Array.isArray(o)||0===o.length)&&o.every((e=>{var o;return(null===e||void 0===e||null===(o=e.purpose)||void 0===o?void 0:o.toLowerCase())===Ke.toLowerCase()}))})))||void 0===e?void 0:e.sort(((e,o)=>new Date(o.createdOn)-new Date(e.createdOn))))||[];(0,i.useEffect)((()=>{(async()=>{try{const o=await F.A.get("/Organiztion/Organization");var e;if(200===(null===o||void 0===o?void 0:o.status)||201===(null===o||void 0===o?void 0:o.status))Ce(null===o||void 0===o||null===(e=o.data)||void 0===e?void 0:e.map((e=>e.organization)))}catch(o){console.error(o.message)}})()}),[]),(0,i.useEffect)((()=>{(async()=>{try{const e=await F.A.put("/Payment/payment-by-cashier",oe.name,{headers:{"Content-Type":"application/json"}});if(200===e.status){const o=await(null===e||void 0===e?void 0:e.data.sort(((e,o)=>o.id-e.id)));to(o)}}catch(e){console.error(e)}})()}),[Re]);const to=e=>{try{if(!Array.isArray(e))throw new Error("Invalid payments data: expected an array.");const o=e.reduce(((e,o)=>{const{paymentType:t,paymentAmount:r,isReversed:n}=o,i=parseFloat(r);if(isNaN(i))return e;e[t]||(e[t]=0);const l="".concat(t," REVERSED");return e[l]||(e[l]=0),!0===n?e[l]-=i:e[t]+=i,e}),{});Object.keys(o).forEach((e=>{!e.endsWith(" REVERSED")||o[e]&&0!==o[e]||delete o[e]})),Ne(o);const t=Object.entries(o).filter((e=>{let[o]=e;return!o.includes("REVERSED")})).reduce(((e,o)=>{let[,t]=o;return e+t}),0);we(t)}catch(o){console.error("This is update Payment Summary Error: ",o)}};(0,i.useEffect)((()=>{(async()=>{try{const o=await F.A.get("/Lookup/payment-channel");var e;if(200===(null===o||void 0===o?void 0:o.status))ue(null===o||void 0===o||null===(e=o.data)||void 0===e?void 0:e.map((e=>e.channel)))}catch(o){console.error(o.message)}})()}),[]);const ro=()=>{ze(!1),le(null)},no=async e=>{try{if("Yes Please!"===e.message){var o,t,r,n,i;We(!0);const l=null!==te&&void 0!==te&&null!==(o=te.whoRequested)&&void 0!==o&&null!==(t=o.toLowerCase())&&void 0!==t&&t.includes("nurse")?"/Patient/cancel-nurse-request":null!==te&&void 0!==te&&null!==(r=te.whoRequested)&&void 0!==r&&null!==(n=r.toLowerCase())&&void 0!==n&&n.includes("doctor")?"/Request/doctor/cancel-request":"/Patient/cancel-patient-request";(await Promise.allSettled(null===e||void 0===e||null===(i=e.selectedPayload)||void 0===i?void 0:i.map((e=>F.A.delete(l,{data:{patientCardNumber:e.patientCardNumber,groupID:e.groupID,purpose:e.purpose}}))))).forEach(((e,o)=>{var t;if("fulfilled"===e.status&&200===(null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t.status)){var r,n,i,l;const t=(null===(r=e.value.data)||void 0===r?void 0:r.msg)||"Success",a=(null===(n=JSON.parse(null===e||void 0===e||null===(i=e.value)||void 0===i||null===(l=i.config)||void 0===l?void 0:l.data))||void 0===n?void 0:n.purpose)||"Unknown";U.oR.success("\u2705 Success ".concat(o+1,": ").concat(t," (Purpose: ").concat(a,")"))}else{var a,d,s,u;const t=(null===e||void 0===e||null===(a=e.reason)||void 0===a||null===(d=a.response)||void 0===d||null===(s=d.data)||void 0===s?void 0:s.msg)||(null===e||void 0===e||null===(u=e.reason)||void 0===u?void 0:u.message)||"Unknown error occurred";U.oR.error("\u274c Failed ".concat(o+1,": ").concat(t)),We(!1)}})),Se((e=>!e)),We(!1),ro()}else le(e),ze(!0)}catch(l){console.error("This is canceling Payment error: ",l)}},io=e=>{if("method"===e.target.name)ve((0,r.A)((0,r.A)({},ce),{},{method:e.target.value,digitalChannel:"",trxref:"",organization:"",employeeId:"",services:"",PRNo:""})),xe((0,r.A)((0,r.A)({},ge),{},{method:"",digitalChannel:"",trxref:"",organization:"",employeeId:"",services:"",PRNo:""})),me(""),fe("");else{if("trxref"===e.target.name&&ao(e.target.value),"employeeId"===e.target.name)return so(e.target.name,e.target.value),void ve((0,r.A)((0,r.A)({},ce),{},{[e.target.name]:e.target.value}));"PRNo"===e.target.name&&lo(e.target.value),ve((0,r.A)((0,r.A)({},ce),{},{[e.target.name]:e.target.value})),xe((0,r.A)((0,r.A)({},ge),{},{[e.target.name]:""}))}},lo=e=>{!/^[0-9]{6,}$/.test(e)&&(null===e||void 0===e?void 0:e.length)>0?fe("Please insert valid receipt number."):fe("")},ao=e=>{e?/^[A-Za-z0-9-_]{10,25}$/.test(e)?me(""):me("Invalid format. Use 10-25 characters with letters, numbers, -, _"):me("Transaction reference is required")},so=(e,o)=>{try{!/^[a-zA-Z0-9\u1200-\u137F\s/\\]+$/.test(o)&&(null===o||void 0===o?void 0:o.length)>0?xe((0,r.A)((0,r.A)({},ge),{},{[e]:"Letters and numbers and \\ / only."})):xe((0,r.A)((0,r.A)({},ge),{},{[e]:""}))}catch(t){console.error("This is letterNumberCheck Error: ",t)}},uo=()=>{z(!1),ve(ie),xe(ie),me(""),fe(""),le(null),be([])},co=[{field:"patientCardNumber",headerName:"Card Number",flex:1},{field:"patientFName",headerName:"First Name",flex:1},{field:"patientGender",headerName:"Gender",flex:1},{field:"noRequestedServices",headerName:"No of Requested Services",flex:1},{field:"requestedCatagories",headerName:"Reason",flex:1,renderCell:e=>{try{var o;return null===e||void 0===e||null===(o=e.row)||void 0===o?void 0:o.requestedCatagories.map((e=>null===e||void 0===e?void 0:e.purpose)).join(", ")}catch(t){console.error("Error Occured on rendering: ",t)}}},{field:"totalPrice",headerName:"Amount",flex:1,renderCell:e=>{try{return(0,W.formatAccounting2)(e.row.totalPrice)}catch(o){console.error("Error Occured on rendering: ",o)}}},{field:"paid",headerName:"Status",flex:1,renderCell:e=>{try{return e.row.paid?"Completed":"Pending"}catch(o){console.error("Error Occured on rendering: ",o)}}},{field:"whoRequested",headerName:"Request From",flex:1},{field:"createdOn",headerName:"Date",flex:1,renderCell:e=>{try{var o;return(0,H.renderETDateAtCell)(null===e||void 0===e||null===(o=e.row)||void 0===o?void 0:o.createdOn)}catch(t){console.error("Error Occured on rendering: ",t)}}},{field:"action",headerName:"Manage",flex:1,renderCell:e=>(0,$.jsx)(a.A,{variant:"contained",color:"light"===Qe.palette.mode?"primary":"secondary",onClick:()=>(e=>{try{le(e),z(!0)}catch(o){console.error("This is The Open Modal error: ",o),U.oR.error("Unable to open.")}})(e.row),children:"Manage"})},{field:"cancel",headerName:"Cancel",flex:1,renderCell:e=>(0,$.jsx)(a.A,{variant:"outlined",color:"error",onClick:()=>no(e.row),children:"Cancel"})}];(0,i.useEffect)((()=>{(async()=>{try{var e,o;Le(!0),M([]);const[t,i,l]=await Promise.all([F.A.get("/Request/doctor/get-request-casheir"),F.A.put("/Patient/get-patient-request-cashier",{loggedInUser:null===oe||void 0===oe?void 0:oe.name}),F.A.put("/Patient/get-nurse-request-cashier")]),a=((null===t||void 0===t||null===(e=t.data)||void 0===e||null===(o=e.data)||void 0===o?void 0:o.value)||[]).reduce(((e,o)=>{const t="".concat(o.patientCardNumber,"_").concat(new Date(o.createdOn).toISOString().slice(0,16));return e[t]||(e[t]={patientCardNumber:o.patientCardNumber,patientFName:[o.patientFirstName,o.patientMiddleName,o.patientLastName].filter(Boolean).join(" "),requestedDepartment:o.requestedDepartment||null,patientMotherName:o.patientMotherName||null,patientAge:o.patientAge,patientGender:o.patientGender,createdBy:o.requestedBy||"-",createdOn:o.createdOn,whoRequested:"Doctor",requestedCatagories:[]}),e[t].requestedCatagories.push(...o.requestedItems.map((e=>({purpose:e.requestedServices,groupID:o.requestGroup,amount:Number(e.price)||0,isPaid:!0})))),e}),{}),d=Object.values(a).map((e=>{var o,t,n;const i=e.requestedCatagories.reduce(((e,o)=>e+Number(o.amount||0)),0),l="lab"===(null===(o=e.requestedDepartment)||void 0===o?void 0:o.toLowerCase())?"Laboratory":"pharmacy"===(null===(t=e.requestedDepartment)||void 0===t?void 0:t.toLowerCase())?"Medicines":"Other";return(0,r.A)((0,r.A)({},e),{},{totalPrice:i,noRequestedServices:e.requestedCatagories.length,requestedCatagories:[{purpose:l,amount:i,groupID:(null===(n=e.requestedCatagories[0])||void 0===n?void 0:n.groupID)||"-",isPaid:!0}],paid:!1,isCompleted:!1})})),s=((null===i||void 0===i?void 0:i.data)||[]).map((e=>{var o,t;let{patientFirstName:i,patientMiddleName:l,patientLastName:a}=e,d=(0,n.A)(e,Q);return(0,r.A)({patientFName:[i,l,a].filter(Boolean).join(" "),whoRequested:null!==(o=((null===d||void 0===d?void 0:d.requestedCatagories)||[]).map((e=>null===e||void 0===e?void 0:e.purpose)).join(", "))&&void 0!==o&&null!==(t=o.toLowerCase())&&void 0!==t&&t.includes("laboratory")?"Laboratory":"Radiology"},d)})),u=((null===l||void 0===l?void 0:l.data)||[]).map((e=>{let{patientFirstName:o,patientMiddleName:t,patientLastName:i,rquestedServices:l}=e,a=(0,n.A)(e,X);return(0,r.A)({patientFName:[o,t,i].filter(Boolean).join(" "),requestedCatagories:null===l||void 0===l?void 0:l.map((e=>{let{services:o,price:t,amount:i}=e,l=(0,n.A)(e,ee);return(0,r.A)({purpose:o,amount:t,isPaid:!0},l)})),whoRequested:"Nurse (Ward)"},a)})),c=[...d,...s,...u].map(((e,o)=>(0,r.A)((0,r.A)({},e),{},{id:o+1})));M(c)}catch(t){console.error("This is Fetch Table Data Error: ",t)}finally{Le(!1)}})()}),[Re]);const vo=e=>{try{return"cash"===e.toLowerCase()?"Cash":"cbhi"===e.toLowerCase()?"CBHI":"credit"===e.toLowerCase()?"Credit":"digital"===e.toLowerCase()?"Digital":"free of charge"===e.toLowerCase()?"Free of Charge":"traffic"===e.toLowerCase()?"Traffic":e}catch(o){return console.error("This is text Normalizig Error: ",o),""}};return(0,$.jsxs)(d.A,{p:3,children:[(0,$.jsx)(s.A,{variant:"h5",gutterBottom:!0,children:"\ud83d\udcb0 Today's Payment Summary"}),(0,$.jsxs)(u.Ay,{container:!0,spacing:2,mb:3,children:[Object.entries(je).map((e=>{let[o,t]=e;return(0,$.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,$.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",p:2,boxShadow:3,borderRadius:3},children:[(0,$.jsx)(v.A,{sx:{bgcolor:"#1976d2",mr:2},variant:"rounded",children:ne[vo(o)]||(0,$.jsx)(B.A,{})}),(0,$.jsxs)(d.A,{children:[(0,$.jsx)(s.A,{variant:"subtitle2",children:o}),(0,$.jsxs)(s.A,{variant:"h6",fontWeight:"bold",children:[(0,W.formatAccounting2)(t)," Birr"]})]})]})},o)})),(0,$.jsx)(u.Ay,{item:!0,xs:12,children:(0,$.jsx)(p.A,{elevation:3,sx:{p:2,backgroundColor:"light"===Qe.palette.mode?"#e3f2fd":Qe.palette.primary.dark,borderLeft:"5px solid ".concat("light"===Qe.palette.mode?"#1976d2":Qe.palette.text.primary),borderRadius:2,mt:1,color:Qe.palette.text.primary},children:(0,$.jsxs)(s.A,{variant:"h6",fontWeight:"bold",children:["Total Received Today: ",(0,W.formatAccounting2)(Ie)," Birr"]})})})]}),(0,$.jsxs)(u.Ay,{container:!0,spacing:2,alignItems:"center",mb:2,children:[(0,$.jsxs)(u.Ay,{item:!0,xs:8,children:[(null===Ze||void 0===Ze?void 0:Ze.length)>0&&(0,$.jsx)(m.A,{value:Ke,onChange:(e,o)=>{Ve(o)},variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{marginTop:5,marginBottom:5},TabIndicatorProps:{sx:{backgroundColor:"dark"===Qe.palette.mode?Qe.palette.secondary.main:Qe.palette.primary.main}},children:Ze.map((e=>(0,$.jsx)(h.A,{label:"".concat(e," (").concat(re(eo(e)),")"),value:e,sx:{color:Qe.palette.text.primary,"&.Mui-selected":{color:"dark"===Qe.palette.mode?Qe.palette.secondary.main:Qe.palette.primary.main}}},e)))}),(0,$.jsx)(s.A,{variant:"h6",children:"\ud83d\udd53 Pending Payments"})]}),(0,$.jsx)(u.Ay,{item:!0,xs:12,md:4,textAlign:"right",children:(0,$.jsxs)(f.A,{direction:"row",spacing:2,justifyContent:"flex-end",alignItems:"center",children:[(0,$.jsx)(a.A,{variant:"contained",color:"success",onClick:()=>Je("/payments"),children:"Add Payment"}),(0,$.jsx)(a.A,{variant:"outlined",sx:{color:Xe.grey[100],borderColor:Xe.grey[100],"&:hover":{borderColor:Xe.grey[300],color:Xe.grey[300]}},onClick:()=>Se((e=>!e)),disabled:Pe,children:Pe?(0,$.jsx)(g.A,{size:24,color:"inherit"}):(0,$.jsx)(V.A,{sx:{transition:"transform 0.5s","&:hover":{transform:"rotate(90deg)"}}})})]})}),(0,$.jsx)(u.Ay,{item:!0,xs:12,children:(0,$.jsx)(P.z,{rows:oo,loading:Pe,columns:co,autoHeight:!0,sx:{minWidth:320}})})]}),(0,$.jsx)(x.A,{open:T,onClose:(e,o)=>{"backdropClick"!==o&&"escapeKeyDown"!==o&&uo()},children:(0,$.jsxs)(d.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:"90vw",sm:500,md:600,lg:700},maxWidth:"95vw",maxHeight:"90vh",bgcolor:"light"===Qe.palette.mode?"background.paper":"background.default",boxShadow:24,borderRadius:3,p:4,overflowY:"auto"},children:[(0,$.jsxs)(s.A,{variant:"h6",gutterBottom:!0,color:"light"===Qe.palette.mode?"primary":"#ffffff",children:["Manage Payment for: ",null===te||void 0===te?void 0:te.patientFName]}),(0,$.jsxs)(c.A,{sx:{mb:2,p:2,backgroundColor:"light"===Qe.palette.mode?"background.paper":"background.default"},children:[(0,$.jsxs)(s.A,{variant:"subtitle1",children:["Card Number: ",(0,$.jsx)("strong",{children:null===te||void 0===te?void 0:te.patientCardNumber})]}),(0,$.jsxs)(s.A,{variant:"subtitle1",color:"text.secondary",children:["Total Amount:"," ",(0,$.jsxs)("strong",{children:[(0,W.formatAccounting2)(null===te||void 0===te||null===(o=te.requestedCatagories)||void 0===o?void 0:o.filter((e=>e.isPaid)).reduce(((e,o)=>e+o.amount),0)),"\xa0 Birr"]})]})]}),(0,$.jsx)(y.A,{fullWidth:!0,margin:"normal",required:!0,error:!(null===ge||void 0===ge||!ge.method),helpertext:null===ge||void 0===ge?void 0:ge.method,children:(0,$.jsxs)(C.A,{name:"method",value:ce.method,onChange:io,displayEmpty:!0,input:(0,$.jsx)(A.A,{sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},color:"dark"===Qe.palette.mode?"#fff":"#000"}}),renderValue:e=>e?(0,$.jsxs)(d.A,{sx:{display:"flex",alignItems:"center"},children:[ne[vo(e)],"\xa0",e]}):(0,$.jsx)("span",{style:{color:"#888"},children:"Select Payment Method...*"}),children:[(0,$.jsx)(b.A,{disabled:!0,value:"",children:(0,$.jsx)("em",{children:"Select Payment Method..."})}),ae.map((e=>(0,$.jsxs)(b.A,{value:null===e||void 0===e?void 0:e.type,children:[ne[vo(null===e||void 0===e?void 0:e.type)]," \xa0 ",null===e||void 0===e?void 0:e.type]},null===e||void 0===e?void 0:e.type)))]})}),(null===ce||void 0===ce||null===(t=ce.method)||void 0===t?void 0:t.toLowerCase().includes("cash"))&&(0,$.jsx)(j.A,{label:"Paper Receipt",variant:"outlined",name:"PRNo",value:null===ce||void 0===ce?void 0:ce.PRNo,onChange:io,fullWidth:!0,error:(null===he||void 0===he?void 0:he.length)>0?!!he:!(null===ge||void 0===ge||!ge.PRNo),helperText:(null===he||void 0===he?void 0:he.length)>0?he:null===ge||void 0===ge?void 0:ge.PRNo,sx:{marginTop:"10px"},InputProps:{sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},color:"dark"===Qe.palette.mode?"#fff":"#000"}},InputLabelProps:{sx:{color:"dark"===Qe.palette.mode?"#ccc":"#555","&.Mui-focused":{color:"dark"===Qe.palette.mode?"#fff":"#000"}}}}),(null===ce||void 0===ce||null===(E=ce.method)||void 0===E?void 0:E.toLowerCase().includes("digital"))&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(y.A,{fullWidth:!0,margin:"normal",required:!0,error:!(null===ge||void 0===ge||!ge.digitalChannel),helpertext:null===ge||void 0===ge?void 0:ge.digitalChannel,children:(0,$.jsxs)(C.A,{name:"digitalChannel",value:ce.digitalChannel,onChange:io,displayEmpty:!0,input:(0,$.jsx)(A.A,{sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},color:"dark"===Qe.palette.mode?"#fff":"#000"}}),renderValue:e=>e||(0,$.jsx)("span",{style:{color:"#888"},children:"Select Digital Channel..."}),children:[(0,$.jsx)(b.A,{disabled:!0,value:"",children:(0,$.jsx)("em",{children:"Select Digital Channel..."})}),se.map((e=>(0,$.jsx)(b.A,{value:e,children:e},e)))]})}),(0,$.jsx)(j.A,{fullWidth:!0,name:"trxref",label:"Transaction Ref. No",value:null===ce||void 0===ce?void 0:ce.trxref,onChange:io,margin:"normal",InputProps:{endAdornment:(0,$.jsx)(N.A,{position:"end",children:K?(0,$.jsx)(g.A,{size:24,color:"inherit"}):(0,$.jsx)(I.A,{onClick:async()=>{try{var e,o;if(Z(!0),(null===ce||void 0===ce||null===(e=ce.trxref)||void 0===e?void 0:e.length)<=0)return void U.oR.info("Transaction Refference Number is Empty.");if((null===ge||void 0===ge||null===(o=ge.trxref)||void 0===o?void 0:o.length)>0||(null===pe||void 0===pe?void 0:pe.length)>0||(null===he||void 0===he?void 0:he.length)>0)return void U.oR.info("Please Fix The Error First.");const t=null===ce||void 0===ce?void 0:ce.trxref;let r,n={};if(ce.digitalChannel.toUpperCase().includes("CBE MOBILE BANKING")||ce.digitalChannel.toUpperCase().includes("TELEBIRR")?(r="/Lookup/payment-verify/".concat(t,"?channel=").concat(null===ce||void 0===ce?void 0:ce.digitalChannel.toUpperCase()),n=ce.digitalChannel.toUpperCase().includes("CBE MOBILE BANKING")?{responseType:"blob"}:{}):ce.digitalChannel.toUpperCase().includes("BANK OF ABYSSINIA")&&(i=t,window.open("https://cs.bankofabyssinia.com/slip/?trx=".concat(i),"_blank","noopener,noreferrer")),!ce.digitalChannel.toUpperCase().includes("BANK OF ABYSSINIA")){const e=await F.A.get(r,n);if(ce.digitalChannel.toUpperCase().includes("TELEBIRR")){const o=window.open();if(o){const t=o.document,r=t.createElement("div");r.id="root",t.body.appendChild(r);O.createRoot(r).render((0,$.jsx)(R.A,{html:null===e||void 0===e?void 0:e.data}))}}else if(ce.digitalChannel.toUpperCase().includes("CBE MOBILE BANKING"))try{const o=null!==e&&void 0!==e&&e.data?new Blob([null===e||void 0===e?void 0:e.data],{type:"application/pdf"}):new Blob("Unknown status received."),t=URL.createObjectURL(o);window.open(t,"_blank")}catch(l){console.error("CBE Error: ",l)}}}catch(l){var t,r,n;console.error(l),ce.digitalChannel.toUpperCase().includes("CBE MOBILE BANKING")&&await(async e=>{try{var o;const t=null===e||void 0===e||null===(o=e.response)||void 0===o?void 0:o.data;if(t instanceof Blob){const e=URL.createObjectURL(t);return window.open(e,"_blank"),void setTimeout((()=>URL.revokeObjectURL(e)),5e3)}let r="Incorrect Receipt ID";null!==t&&void 0!==t&&t.message&&(r=String(t.message));const n=await k.PDFDocument.create(),i=n.addPage([600,400]),{height:l}=i.getSize();i.drawText(r,{x:50,y:l-100,size:16,color:(0,k.rgb)(0,0,0)});const a=await n.save(),d=new Blob([a],{type:"application/pdf"}),s=URL.createObjectURL(d);window.open(s,"_blank"),setTimeout((()=>URL.revokeObjectURL(s)),5e3)}catch(t){console.error("generateAndOpenPDF error:",t)}})(l),U.oR.error((null===l||void 0===l||null===(t=l.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||(null===l||void 0===l||null===(n=l.message)||void 0===n?void 0:n.toLowerCase().includes("network"))&&(null===l||void 0===l?void 0:l.message)||"Something is wrong Please try again")}finally{Z(!1)}var i},edge:"end",children:(0,$.jsx)(S.A,{})})}),sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},color:"dark"===Qe.palette.mode?"#fff":"#000"}},InputLabelProps:{sx:{color:"dark"===Qe.palette.mode?"#ccc":"#555","&.Mui-focused":{color:"dark"===Qe.palette.mode?"#fff":"#000"}}},error:(null===pe||void 0===pe?void 0:pe.length)>0?!!pe:!(null===ge||void 0===ge||!ge.trxref),helperText:(null===pe||void 0===pe?void 0:pe.length)>0?pe:null===ge||void 0===ge?void 0:ge.trxref})]}),(null===ce||void 0===ce||null===(q=ce.method)||void 0===q?void 0:q.toLowerCase().includes("credit"))&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(y.A,{fullWidth:!0,margin:"normal",required:!0,error:!(null===ge||void 0===ge||!ge.organization),children:(0,$.jsxs)(C.A,{name:"organization",value:ce.organization,onChange:io,displayEmpty:!0,input:(0,$.jsx)(A.A,{sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},color:"dark"===Qe.palette.mode?"#fff":"#000"}}),renderValue:e=>e||(0,$.jsx)("span",{style:{color:"#888"},children:"Select Organization..."}),children:[(0,$.jsx)(b.A,{disabled:!0,value:"",children:(0,$.jsx)("em",{children:"Select Organization..."})}),ye.map((e=>(0,$.jsx)(b.A,{value:e,children:e},e)))]})}),(0,$.jsx)(j.A,{fullWidth:!0,name:"employeeId",label:"Employee ID",value:ce.employeeId,onChange:io,margin:"normal",required:!0,error:!(null===ge||void 0===ge||!ge.employeeId),helperText:null===ge||void 0===ge?void 0:ge.employeeId,InputProps:{sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},color:"dark"===Qe.palette.mode?"#fff":"#000"}},InputLabelProps:{sx:{color:"dark"===Qe.palette.mode?"#ccc":"#555","&.Mui-focused":{color:"dark"===Qe.palette.mode?"#fff":"#000"}}}})]}),Ge&&(0,$.jsx)($.Fragment,{children:(0,$.jsx)(y.A,{fullWidth:!0,margin:"normal",required:!0,error:!(null===ge||void 0===ge||!ge.services),children:(0,$.jsxs)(C.A,{name:"services",value:(null===ce||void 0===ce?void 0:ce.services)||"",onChange:io,displayEmpty:!0,input:(0,$.jsx)(A.A,{sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"dark"===Qe.palette.mode?"#fff":"#000"},color:"dark"===Qe.palette.mode?"#fff":"#000"}}),renderValue:e=>e||(0,$.jsx)("span",{style:{color:"#888"},children:"Select Services..."}),children:[(0,$.jsx)(b.A,{disabled:!0,value:"",children:(0,$.jsx)("em",{children:"Select Services..."})}),null===Ae||void 0===Ae?void 0:Ae.map((e=>(0,$.jsx)(b.A,{value:null===e||void 0===e?void 0:e.description,children:null===e||void 0===e?void 0:e.description},null===e||void 0===e?void 0:e.id)))]})})}),(0,$.jsxs)(u.Ay,{container:!0,spacing:2,sx:{mt:2},children:[(0,$.jsx)(u.Ay,{item:!0,xs:6,children:(0,$.jsx)(a.A,{variant:"outlined",fullWidth:!0,color:"error",onClick:()=>uo(),children:"Cancel"})}),(0,$.jsx)(u.Ay,{item:!0,xs:6,children:(0,$.jsx)(a.A,{variant:"contained",fullWidth:!0,color:"light"===Qe.palette.mode?"primary":"secondary",onClick:async()=>{try{var e,o;const t="Please Fill this field",n={},i=null===(e=ce.method)||void 0===e?void 0:e.toUpperCase();if(ce.method||(n.method=t),null!==i&&void 0!==i&&i.includes("DIGITAL")&&(ce.digitalChannel||(n.digitalChannel=t),ce.trxref&&!pe||(n.trxref=t)),null!==i&&void 0!==i&&i.includes("CREDIT")&&(ce.organization||(n.organization=t),ce.employeeId||(n.employeeId=t)),null!==i&&void 0!==i&&i.includes("CASH")&&(ce.PRNo&&!he||(n.PRNo=t)),(null===Ae||void 0===Ae?void 0:Ae.length)>0&&!ce.services&&(n.services=t),Object.keys(n).length>0)return xe((e=>(0,r.A)((0,r.A)({},e),n))),void U.oR.error("Please Fill All Fields.");if(Object.values(ge).some((e=>(null===e||void 0===e?void 0:e.length)>0)))return void U.oR.error("Please fix the error first.");const l=null===te||void 0===te||null===(o=te.requestedCatagories)||void 0===o?void 0:o.filter((e=>!0===e.isPaid));if(null===l||void 0===l||!l.length)return void U.oR.error("Should have at least one payment.");if(l.reduce(((e,o)=>e+(o.amount||0)),0)<=0)return void U.oR.error("Should have Total Amount Greater than zero (0).");const a={cardNumber:null===te||void 0===te?void 0:te.patientCardNumber,amount:l,method:null===ce||void 0===ce?void 0:ce.method,reason:l.map((e=>e.purpose)),description:"-"};qe(!0),Me(a||[])}catch(t){console.error("This is Handle Confirm Error:",t),U.oR.error("Internal Server Error.")}},disabled:ke,startIcon:ke?(0,$.jsx)(g.A,{size:20}):(0,$.jsx)(B.A,{}),children:ke?"Processing...":"Confirm Payment"})})]})]})}),(0,$.jsx)(G.A,{open:Ee,onClose:()=>{qe(!1),Me(null)},data:De,onPrint:async()=>{try{var e,o,t,n,i,l,a;Oe(!0),Be(!0);const p=null===te||void 0===te||null===(e=te.whoRequested)||void 0===e||null===(o=e.toLowerCase())||void 0===o?void 0:o.includes("nurse"),m="lab"===(null===te||void 0===te||null===(t=te.requestedDepartment)||void 0===t?void 0:t.toLowerCase()),h="pharmacy"===(null===te||void 0===te||null===(n=te.requestedDepartment)||void 0===n?void 0:n.toLowerCase()),f=((null===te||void 0===te?void 0:te.requestedCatagories)||[]).map((e=>({amount:Number((null===e||void 0===e?void 0:e.amount)||0),purpose:(null===e||void 0===e?void 0:e.purpose)||"-",groupID:(null===e||void 0===e?void 0:e.groupID)||"-",isPaid:!0}))),g=(0,r.A)((0,r.A)((0,r.A)({paymentType:null===ce||void 0===ce?void 0:ce.method,cardNumber:null===te||void 0===te?void 0:te.patientCardNumber,descriptionId:(null===Ae||void 0===Ae?void 0:Ae.length)>0&&(null===Ae||void 0===Ae||null===(i=Ae.find((e=>(0,Y.f)(e.description)===(0,Y.f)(null===ce||void 0===ce?void 0:ce.services))))||void 0===i?void 0:i.id)||0,amount:f,description:"-",createdby:null===oe||void 0===oe?void 0:oe.name,paymentRefNo:null===ce||void 0===ce?void 0:ce.PRNo,channel:(null===ce||void 0===ce?void 0:ce.digitalChannel)||"-",paymentVerifingID:(null===ce||void 0===ce?void 0:ce.trxref)||"-",patientWorkID:(null===ce||void 0===ce?void 0:ce.employeeId)||"-",organization:(null===ce||void 0===ce?void 0:ce.organization)||"-"},p&&{isNurseRequest:!0}),m&&{isLabRequest:!0}),h&&{isPharmacy:!0}),x=await F.A.post("/Payment/add-payment",g,{headers:{"Content-Type":"application/json"}});if((null===x||void 0===x||null===(l=x.data)||void 0===l||null===(a=l.refNo)||void 0===a?void 0:a.length)>0){var d,s,u,c,v;U.oR.success("Payment Regitstered Under ".concat(null===x||void 0===x||null===(d=x.data)||void 0===d?void 0:d.refNo)),Se((e=>!e));const e={method:ce.method||"",amount:(null===te||void 0===te||null===(s=te.requestedCatagories)||void 0===s?void 0:s.filter((e=>!0===e.isPaid)))||"",patientName:(null===te||void 0===te?void 0:te.patientFName)||"",cardNumber:(null===te||void 0===te?void 0:te.patientCardNumber)||"",digitalChannel:(null===ce||void 0===ce?void 0:ce.digitalChannel)||"",trxref:(null===ce||void 0===ce?void 0:ce.trxref)||"",organization:(null===ce||void 0===ce?void 0:ce.organization)||"",employeeId:(null===ce||void 0===ce?void 0:ce.employeeId)||"",cbhiId:null===x||void 0===x||null===(u=x.data)||void 0===u||null===(c=u.data)||void 0===c?void 0:c.map((e=>e.patientCBHI_ID))[0],refNo:(null===x||void 0===x||null===(v=x.data)||void 0===v?void 0:v.refNo)||"-",recipt:(null===ce||void 0===ce?void 0:ce.PRNo)||"-"};await(0,W.generatePDF)(e),Be(!1),Me(null),uo()}}catch(h){var p,m;console.error("This is Error on handle Save: ",h),U.oR.error((null===h||void 0===h||null===(p=h.response)||void 0===p||null===(m=p.data)||void 0===m?void 0:m.errorDescription)||"Internal Server Error.")}finally{Oe(!1),Be(!1),qe(!1)}},onloading:Te}),(0,$.jsx)(_.A,{isOpen:Fe,onClose:ro,onConfirm:no,userData:te,onloading:Ue}),(0,$.jsx)(U.N9,{})]})}},85337:(e,o,t)=>{t.d(o,{A:()=>C});var r=t(89379),n=t(65043),i=t(26240),l=t(57556),a=t(266),d=t(46946),s=t(94496),u=t(71716),c=t(39336),v=t(99784),p=t(1273),m=t(72882),h=t(97334),f=t(74802),g=t(98348),x=t(70579);const y={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:500,boxShadow:24,p:3,borderRadius:2},C=e=>{var o;let{isOpen:t,onClose:C,onConfirm:A,userData:b,onloading:j}=e;const[N,I]=(0,n.useState)([]),w=(0,i.A)(),k="light"===w.palette.mode?w.palette.primary.main:w.palette.secondary.main;(0,n.useEffect)((()=>{t&&I([])}),[b,t]);return(0,x.jsx)(l.A,{open:t,onClose:(e,o)=>{"backdropClick"!==o&&"escapeKeyDown"!==o&&C()},disableEscapeKeyDown:!0,closeAfterTransition:!0,BackdropComponent:a.A,BackdropProps:{timeout:500},"aria-labelledby":"confirmation-modal-title","aria-describedby":"confirmation-modal-description",children:(0,x.jsxs)(d.A,{sx:(0,r.A)((0,r.A)({},y),{},{bgcolor:"light"===w.palette.mode?"background.paper":"background.default"}),children:[(0,x.jsxs)(d.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,x.jsxs)(s.A,{variant:"h6",fontWeight:"bold",color:"primary",id:"confirmation-modal-title",children:[(0,x.jsx)(g.A,{sx:{fontSize:30,verticalAlign:"middle",mr:1}}),"Confirm Cancellation"]}),(0,x.jsx)(u.A,{onClick:C,color:"primary","aria-label":"close modal",children:(0,x.jsx)(f.A,{})})]}),(0,x.jsxs)(s.A,{variant:"body1",mt:2,mb:1,children:["Cancel payment for ",(0,x.jsx)("strong",{children:null===b||void 0===b?void 0:b.patientFName}),"?"]}),(0,x.jsx)(c.A,{sx:{my:2}}),(0,x.jsx)(s.A,{variant:"subtitle1",fontWeight:"medium",mb:1,children:"Select categories to cancel:"}),(null===b||void 0===b||null===(o=b.requestedCatagories)||void 0===o?void 0:o.length)>0?b.requestedCatagories.map((e=>(0,x.jsx)(v.A,{control:(0,x.jsx)(p.A,{checked:N.includes(e.groupID),onChange:()=>(e=>{try{I((o=>o.includes(null===e||void 0===e?void 0:e.groupID)?null===o||void 0===o?void 0:o.filter((o=>o!==e.groupID)):[...o,e.groupID]))}catch(o){console.error("This is handle CheckBox Error: ",o)}})(e),sx:{color:k,"&.Mui-checked":{color:k}}}),label:"".concat(e.purpose," - ").concat(e.amount," Birr"),sx:{textAlign:"left"}},e.groupID))):(0,x.jsx)(s.A,{variant:"body2",color:"text.secondary",children:"No categories found."}),(0,x.jsxs)(d.A,{display:"flex",justifyContent:"flex-end",mt:3,gap:2,children:[(0,x.jsx)(m.A,{variant:"outlined",color:"error",onClick:C,disabled:j,children:"Cancel"}),(0,x.jsx)(m.A,{variant:"contained",color:"light"===w.palette.mode?"primary":"secondary",disabled:0===N.length||j,onClick:()=>{try{var e,o;const t=null===b||void 0===b||null===(e=b.requestedCatagories)||void 0===e||null===(o=e.filter((e=>N.includes(e.groupID))))||void 0===o?void 0:o.map((e=>({patientCardNumber:null===b||void 0===b?void 0:b.patientCardNumber,groupID:e.groupID,purpose:e.purpose||"N/A"})));t.length>0&&A({selectedPayload:t,message:"Yes Please!"})}catch(t){console.error("This is the handle Confimr Error: ",t)}},children:j?(0,x.jsx)(h.A,{size:24,color:"inherit"}):"Confirm"})]})]})})}}}]);
//# sourceMappingURL=5092.dc8ea4a7.chunk.js.map